import"../../web_modules/imba/dist/imba.js";function f(a,b){var c=Object.getOwnPropertyDescriptors(b);return Object.defineProperties(a.prototype,c),a}class e{constructor(a,b,c,d={}){this.node=a,this.route=a.router.routeFor(a,b,c?c.route:null,d),this.match=null,this.options=d,this.placeholder=a.$placeholder||new Comment(""+b)}get raw(){return this.route.raw}set path(a){this.route.path=a}get params(){return this.match}get sticky(){return this.options&&this.options.sticky}get exact(){return this.options&&this.options.exact}isActive(){return this.match&&this.match.active}resolve(){let a=this.match,b=a&&a.url,c=this.route.test();if(c){let d=a&&a.active;return c.active=!0,c!=a&&(this.match=c),(c!=a||!d||c.url!=b)&&this.resolved(c,a,b),d||this.enter(),c}else a&&a.active?(a.active=!1,this.leave()):a||(this.match=a={},this.leave());return a}enter(){var a;return this.node.flags.remove("not-routed"),this.node.flags.add("routed"),(a=this.node)&&a.routeDidEnter&&a.routeDidEnter(this)}resolved(a,b,c){var d;return(d=this.node)&&d.routeDidResolve&&d.routeDidResolve(a,b,c)}leave(){var a;return this.node.flags.add("not-routed"),this.node.flags.remove("routed"),(a=this.node)&&a.routeDidLeave&&a.routeDidLeave(this)}}class g extends e{enter(){return this}resolve(){return this.url=this.route.resolve(),super.resolve(...arguments)}resolved(){return this}leave(){return this}go(){let a=this.route.resolve();return this.sticky&&this.match&&!this.match.active&&(a=this.match.url||a),this.options&&this.options.replace?this.node.router.replace(a):this.node.router.go(a)}}f(Element,{get route(){return this.$route},get parentRoute(){return this.$context.route},set route(a){var b=this;if(this.$route&&this.$route.raw!=a){this.$route.path=a;return}let c=a[0]!="/"?this.parentRoute:null;this.$route=new e(this,a,c,this.route__),this.end$=this.end$routed,this.insertInto$=function(d){return d.appendChild$(b.$route.isActive()?b:b.$route.placeholder)}},set routeTo(a){var b=this;if(this.$route){this.$route.raw!=a&&(this.$route.path=a);return}let c=a[0]!="/"?this.parentRoute:null;this.$route=this.$routeTo=new g(this,a,c,this.routeTo__),this.end$=this.end$routeTo,this.onclick=function(d){if(!d.altKey&&!d.metaKey)return d.preventDefault(),b.$route.go()}},end$routed(){if(this.$route){this.$route.resolve();if(!this.$route.isActive())return}if(this.visit)return this.visit()},end$routeTo(){if(this.$route){let a=this.$route.resolve(),b=this.$route.url;this.$route.sticky&&a.url&&(console.log(a.url),b=a.url),this.nodeName=="A"&&this.setAttribute("href",b),this.flags.toggle("active",a&&a.active||!1)}if(this.visit)return this.visit()},routeDidEnter(a){let b=a.placeholder;if(b.parentNode&&b!=this)return b.replaceWith$(this)},routeDidLeave(a){let b=a.placeholder;return this.parentNode&&b!=this&&this.replaceWith$(b),this},routeDidResolve(a,b){var c=this;return;return!this.load||a==b&&!this.reload?(this&&this.routeDidMatch&&this.routeDidMatch(a),this&&this.routeDidLoad&&this.routeDidLoad(a,b),this):(this.$route.load(async function(){c.routeDidMatch(a);let d;try{a!=b?d=await c.load(a,b):c.reload&&(d=await c.reload(a,b))}catch(h){d=400,c.routeDidFail(h)}return c.routeDidLoad(d),d}),this)}});
