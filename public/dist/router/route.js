import"../../web_modules/imba/dist/imba.js";function q(a){return a?a.toIterable?a.toIterable():a:[]}var s=typeof window!=="undefined";export class Route{constructor(a,b,d,e={}){this.parent=d,this.router=a,this.options=e,this.status=200,this.path=b}set path(a){var b=this;if(this.$path==a)return;this.raw=a,this.$path=a,this.groups=[],this.params={},this.cache={};if(a.indexOf("?")>=0){let o=a.split("?");a=o.shift(),this.query={};for(let i=0,g=q(o.join("?").split("&")),n=g.length;i<n;i++){let l=g[i];if(!l)continue;var[d,e]=l.split("=");d[0]=="!"&&(d=d.slice(1),e=!1),e===""&&(e=!1),this.query[d]=e||(e===!1?!1:!0)}}a=a.replace(/\:(\w+|\*)(\.)?/g,function(o,i,g){return i!="*"&&b.groups.push(i),g?"([^/#.?]+).":"([^/#?]+)"});if(a==""&&this.query)return;a="^"+a;let k=a[a.length-1];this.options.exact&&k!="$"?a=a+"(?=[#?]|$)":k!="/"&&k!="$"&&a!="^/"&&(a=a+"(?=[/#?]|$)"),this.regex=new RegExp(a)}test(a,b){var d,e;a||(a=this.router.location),b||(b=a.pathname);let k=a.path;if(k==this.cache.url)return this.cache.match;let o="",i=b;this.cache.url=k,this.cache.match=null;let g;if(this.query){g={};for(let n=this.query,l=0,h=Object.keys(n),m=h.length,j,c;l<m;l++){j=h[l],c=n[j];let f=a.query(j),p=j;if(c===!1){if(f)return null;continue}c[0]==":"&&(p=c.slice(1),c=!0);if(c==!0&&f||c==f)g[p]=f;else return null}}this.parent&&this.raw[0]!="/"&&((d=this.parent.test(a,b))&&(b.indexOf(d.path)==0&&(o=d.path+"/",i=b.slice(d.path.length+1))));if(e=this.regex?i.match(this.regex):[""]){let n=o+e[0],l=this.params;if(n==this.params.path)this.params.url=k;else{this.params={path:n,url:k};if(this.groups.length)for(let h=0,m=q(e),j=m.length,c;h<j;h++){let f=m[h];(c=this.groups[h-1])&&(this.params[c]=f)}}if(g){let h=!1;for(let m=0,j=Object.keys(g),c=j.length,f,p;m<c;m++)f=j[m],p=g[f],this.params[f]!=p&&(h=!0,this.params[f]=p);h&&l==this.params&&(this.params=Object.assign({},this.params))}return this.cache.match=this.params}return this.cache.match=null}resolve(a){var b;return this.raw[0]=="/"?this.raw:(a||(a=this.router.url),this.cache.resolveUrl==a&&this.cache.resolved?this.cache.resolved:(this.cache.resolveUrl=a,this.parent?(b=this.parent.test())&&(this.raw[0]=="?"?this.cache.resolved=b.path+this.raw:this.cache.resolved=b.path+"/"+this.raw):this.cache.resolved=this.raw,this.cache.resolved))}}
